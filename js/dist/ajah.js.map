{"version":3,"file":"ajah.js","sources":["../src/ajah.js"],"sourcesContent":["////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////\n// AJAH Queue Manager (Asynchronous Javascript and HTML for server side rendering)\n// Copyright Mike Agar 2014\n// MIT License\n\n\t//POLYFILL for IE9+ to add remove() function. see: https://developer.mozilla.org/en-US/docs/Web/API/ChildNode/remove\n\t(function (arr) {\n\t\tarr.forEach(function (item) {\n\t\t\tif (item.hasOwnProperty('remove')) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tObject.defineProperty(item, 'remove', {\n\t\t\t\tconfigurable: true,\n\t\t\t\tenumerable: true,\n\t\t\t\twritable: true,\n\t\t\t\tvalue: function remove() {\n\t\t\t\t\tif (this.parentNode === null) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tthis.parentNode.removeChild(this);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t})([Element.prototype, CharacterData.prototype, DocumentType.prototype]);\n\nfunction Ajah(){\n\t//STATE\n\tthis.debug = true;\n\tthis.waiting = new Array(0);\n\tthis.upload = new Array(0); //low priority File Upload Queue\n\tthis.uploadActive = false;\n\tthis.active = new Array(0);\n\tthis.max_active = 2; //MSIE max concurrent requests.  Some browsers can do more, we should consider dynamically changing this...\n\tthis.intervalID = null; //timer ID, used to shutdown when waiting queue is empty.\n\tthis.id = 0; //trick to keep browser from caching results; future use could be to use the id to cancel requests.\n\n}\n\n//////////////////////////////////////////\n// AJAX Helper Functions\n\nAjah.prototype.log = function(msg){\n\tif(ajah.debug){\n\t\tconsole.log(\"AJAX[\"+this.active.length+\"] \"+msg);\n\t}\n};\n\n\nAjah.prototype.stopMonitor = function(){\n\tif(ajah.waiting.length===0 && ajah.upload.length===0){\n\t\tif(this.intervalID){\n\t\t\t//shut down the timer;\n\t\t\twindow.clearInterval(this.intervalID);\n\t\t\tthis.intervalID=null;\n\t\t\tthis.log(\"<<< Stopping interval timer.\");\n\n\t\t\t//Hide background spinner\n\t\t\t$(\"body\").css(\"cursor\",\"auto\");\n\t\t}\n\t}\n};\n\nAjah.prototype.startMonitor = function(){\n\tif(!this.intervalID){\n\t\t//start the interval to poll for open slot\n\t\tthis.intervalID = window.setInterval(function(){ajah.processWaiting();},50); //50ms polling\n\t\taInitialized = true;\n\t\tthis.log(\">>> Starting interval timer.\");\n\n\t\t//Show background spinner\n\t\t$(\"body\").css(\"cursor\",\"progress\");\n\t}\n};\n\nAjah.prototype.finish = function(url){\n\t//Remove url from active queue.\n\tfunction remove(val,from) {\n\t\tfor (var i = 0; i < from.length; i++) {\n\t\t\tif (from[i] === val) {\n\t\t\t\tfrom.splice(i, 1);\n\t\t\t\ti--;\n\t\t\t}\n\t\t}\n\t\treturn from;\n\t}\n\n\tajah.active = remove(url,ajah.active);\n};\n\n//HACK: There can be only one!  (id=session_override)\nAjah.prototype.processSO = function(raw){\n\tvar parser = new DOMParser();\n\tvar html = parser.parseFromString(raw,'text/html');\n\tvar newSO;\n\tvar oldSO;\n\thtml.innerHTML = raw;\n\tif(oldSO = document.getElementById('session_override')){\n\t\t//Found an old Session Override\n\t\tif(newSO = html.getElementById('session_override')){\n\t\t\t//Found a New SO, update the old one, and remove the new one from the RAW result\n\t\t\toldSO.innerHTML = newSO.innerHTML;\n\t\t\tnewSO.remove();\n\t\t}\n\t}\n\treturn html.innerHTML;\n};\n\nAjah.prototype.processWaiting = function (){\n\n\tfunction getXmlHttpObject(){\n\t\tvar xmlHttp=null;\n\t\ttry{\n\t\t\t// Firefox, Opera 8.0+, Safari\n\t\t\txmlHttp=new XMLHttpRequest();\n\t\t}catch (e1){\n\t\t\t// Internet Explorer\n\t\t\ttry{\n\t\t\t\txmlHttp=new ActiveXObject(\"Msxml2.XMLHTTP\");\n\t\t\t}catch (e2) {\n\t\t\t\txmlHttp=new ActiveXObject(\"Microsoft.XMLHTTP\");\n\t\t\t}\n\t\t}\n\t\treturn xmlHttp;\n\t}\n\n\tfunction parseURL(url) {\n\t\t//CREDIT: http://james.padolsey.com/javascript/parsing-urls-with-the-dom/\n\t\tvar a =  document.createElement('a');\n\t\ta.href = url;\n\t\treturn {\n\t\t\tsource: url,\n\t\t\tprotocol: a.protocol.replace(':',''),\n\t\t\thost: a.hostname,\n\t\t\tport: a.port,\n\t\t\tquery: a.search,\n\t\t\tparams: (function(){\n\t\t\t\tvar ret = {},\n\t\t\t\t\tseg = a.search.replace(/^\\?/,'').split('&'),\n\t\t\t\t\tlen = seg.length, i = 0, s;\n\t\t\t\tfor (;i<len;i++) {\n\t\t\t\t\tif (!seg[i]) { continue; }\n\t\t\t\t\ts = seg[i].split('=');\n\t\t\t\t\tret[s[0]] = s[1];\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t})(),\n\t\t\tfile: (a.pathname.match(/\\/([^\\/?#]+)$/i) || [,''])[1],\n\t\t\thash: a.hash.replace('#',''),\n\t\t\tpath: a.pathname.replace(/^([^\\/])/,'/$1'),\n\t\t\trelative: (a.href.match(/tps?:\\/\\/[^\\/]+(.+)/) || [,''])[1],\n\t\t\tsegments: a.pathname.replace(/^\\//,'').split('/')\n\t\t};\n\t}\n\n\n\tfunction appendId(url){\n\t\tvar out;\n\t\tvar cache_hack;\n\t\tvar parts;\n\t\tvar session_override;\n\t\t//HACK: ensures all AJAXy transactions are not cached, since the URL is ever changing...\n\t\tajah.id++;\n\t\tcache_hack = ajah.id + Math.random();\n\t\tparts = parseURL(url);\n\t\tif(parts.query.length === 0){\n\t\t\tajah.log(\"Ajah.processWaiting() URL Missing query, adding one now.\");\n\t\t\tout = url+\"?ajah=\"+cache_hack;\n\t\t}else{\n\t\t\tout = url+\"&ajah=\"+cache_hack;\n\t\t}\n\n\t\t//HACK: Third Party Cookies are dying, so we are going to add the Session Override to the URL (session_override)\n\t\tif(session_override = document.getElementById( \"session_override\" )){\n\t\t\tout = out+\"&session_override=\"+session_override.innerHTML;\n\t\t}\n\n\t\treturn out;\n\t}\n\n\n\tif(this.active.length < this.max_active){\n\t\tvar request;\n\n\t\tif (this.waiting[0]) {\n\t\t\trequest = this.waiting.shift();\n\n\t\t\tvar xmlHttp=null;\n\t\t\txmlHttp=getXmlHttpObject();\n\t\t\tif (xmlHttp===null){\n\t\t\t\tthis.log(\"Failed to GetHttpObject, Aborting.\");\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t//Move it to the active queue\n\t\t\tthis.active.push(request.url);\n\n\t\t\t//custom lambda function to handle this request\n\t\t\t//Calls the \"func\" with whatever is at the endpoint \"url\"\n\t\t\txmlHttp.onreadystatechange= function () {\n\t\t\t\tvar content;\n\t\t\t\tif (xmlHttp.readyState == 4) {\n\t\t\t\t\tswitch(xmlHttp.status){\n\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\t//HACK: we can only have one active SO id, \n\t\t\t\t\t\t\t//      so update the current one, and remove it from the response\n\t\t\t\t\t\t\tcontent = ajah.processSO(xmlHttp.responseText);\n\t\t\t\t\t\t\t//success do what was asked\n\t\t\t\t\t\t\trequest.func(content);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\tajah.log(\"Server Error Code \"+xmlHttp.status+\" on url \"+request.url);\n\t\t\t\t\t}\n\n\t\t\t\t\t//and then clean up active queue\n\t\t\t\t\tajah.finish(request.url);\n\t\t\t\t\tajah.stopMonitor();\n\t\t\t\t}\n\t\t\t};\n\t\t\txmlHttp.open(\"POST\",appendId(request.url),true);\n\t\t\tif(request.hasOwnProperty('params')){\n\t\t\t\txmlHttp.setRequestHeader(\"Content-type\",\"application/x-www-form-urlencoded\");\n\t\t\t\txmlHttp.send(request.params);\n\t\t\t}else{\n\t\t\t\txmlHttp.send(null);\n\t\t\t}\n\t\t}else if(this.upload[0]){\n\t\t\t//File upload queue.  only do one file upload at a time, \n\t\t\t//never use more than one of the available AJAX threads\n\t\t\tif(!this.uploadActive){\n\t\t\t\trequest = this.upload.shift();\n\n\t\t\t\tvar XHR=null;\n\t\t\t\tXHR=getXmlHttpObject();\n\t\t\t\tif (XHR===null){\n\t\t\t\t\tthis.log(\"Failed to GetHttpObject, Aborting.\");\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t//Move it to the active queue\n\t\t\t\tthis.active.push(request.url);\n\t\t\t\tthis.uploadActive = true;\n\n\t\t\t\t//custom lambda function to handle this request\n\t\t\t\t//Calls the \"func\" with whatever is at the endpoint \"url\"\n\t\t\t\tXHR.onreadystatechange = function () {\n\t\t\t\t\tif (XHR.readyState == 4) {\n\t\t\t\t\t\tswitch(XHR.status){\n\t\t\t\t\t\t\tcase 200:\n\t\t\t\t\t\t\t\t//HACK: we can only have one active SO id, \n\t\t\t\t\t\t\t\t//      so update the current one, and remove it from the response\n\t\t\t\t\t\t\t\tcontent = ajah.processSO(xmlHttp.responseText);\n\t\t\t\t\t\t\t\t//success do what was asked\n\t\t\t\t\t\t\t\trequest.func(content);\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tajah.log(\"Server Error Code \"+XHR.status+\" on url \"+request.url+\" (file upload)\");\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t//and then clean up active queue\n\t\t\t\t\t\tajah.uploadActive = false;\n\t\t\t\t\t\tajah.finish(request.url);\n\t\t\t\t\t\tajah.stopMonitor();\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tXHR.open(\"POST\", appendId(request.url)+\"&AJAX_FILENAME=\"+request.file.name, true);\n\t\t\t\tXHR.send(request.file);\n\t\t\t}else{\n\t\t\t\t//busy, so make sure the monitor is running...\n\t\t\t\tthis.startMonitor();\n\t\t\t}\n\t\t}\n\t}else{\n\t\t//make sure the background handler is running.\n\t\tthis.startMonitor();\n\t}\n\n};\n\n\n\n//////////////////////////////////////////////////////////////\n// AJAX Interface\nAjah.prototype.inQueue = function(url){\n\t//Check Active queue\n\tfor (var i = 0; i < this.active.length; i++) {\n\t\tif (this.active[i] === url) return true;\n\t}\n\t//Check Waiting queue\n\tfor (var j=0; j < this.waiting.length; j++) {\n\t\tif (this.waiting[j].url === url) return true;\n\t}\n\t//Check Upload queue\n\tfor (var k=0; k < this.upload.length; k++) {\n\t\tif (this.upload[k].url === url) return true;\n\t}\n\treturn false;\n};\n\nAjah.prototype.Busy = function(){\n\treturn this.active.length > 0;\n};\n\n\nAjah.prototype.DoWith = function(func,url){\n\tif(!this.inQueue(url)){\n\t\tthis.log(\"DoWith() on \"+url);\n\t\tthis.waiting.push({func: func, url:  url});\n\t\twindow.setTimeout(function(){ajah.processWaiting();},1);\n\t}else{\n\t\tthis.log(\"DoWith() URL already queued. Skipping this \"+url);\n\t}\n};\n\nAjah.prototype.DoWithPost = function(func,url,params){\n\tif(!this.inQueue(url)){\n\t\tthis.log(\"DoWith() on \"+url);\n\t\tthis.waiting.push({func: func, url:  url, params: params});\n\t\twindow.setTimeout(function(){ajah.processWaiting();},1);\n\t}else{\n\t\tthis.log(\"DoWith() URL already queued. Skipping this \"+url);\n\t}\n};\n\nAjah.prototype.Send = function (url){\n\tthis.log(\"Send() on \"+url);\n\tthis.DoWith(function(msg){return;},url); //throw away the result\n};\n\nAjah.prototype.SendFile = function (url,file,func){\n\tthis.log(\"SendFile() \"+file.name+\" to \"+url);\n\tthis.upload.push({func: func, url:  url, file: file});\n\twindow.setTimeout(function(){ajah.processWaiting();},1);\n};\n\n\nAjah.prototype.SelfTest = function (url){\n\tfunction paint(msg){\n\t\tLogDiv(\"ajah_test\",\"<pre>\"+msg+\"</pre>\");\n\t}\n\n\tfunction done(msg){\n\t\tLogDiv(\"ajah_test\",\"<h3>AJAX Self Test END</h3>\");\n\t}\n\n\tthis.debug=true;\n\tif(this.id<5)LogDiv(\"ajah_test\",\"<h3>AJAX Self Test START</h3>\");\n\tthis.DoWith(paint, \"robots.txt\");\n\tthis.DoWith(paint, \"404.txt\");\n\tthis.DoWith(paint, url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.Send(url);\n\tthis.DoWith(paint, url);\n\tthis.DoWith(paint, url);\n\tthis.DoWith(paint, url);\n\tthis.DoWith(paint, url);\n\tthis.DoWith(paint, url);\n\tthis.DoWith(paint, url);\n\tif(this.id<10){\n\t\twindow.setTimeout(function(){ajah.SelfTest(url);},100+this.id*50);\n\t}else{\n\t\tthis.DoWith(done, \"index.php\");\n\t}\n};\n\n\n////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////\n////////////////////////////////////////////////////////////////////////////////////\n//AJAX Singleton\n\nvar ajah;\najah = new Ajah();\n\nexport default ajah;\n\n"],"names":["arr","forEach","item","hasOwnProperty","Object","defineProperty","configurable","enumerable","writable","value","remove","parentNode","removeChild","Element","prototype","CharacterData","DocumentType","Ajah","debug","waiting","Array","upload","uploadActive","active","max_active","intervalID","id","log","msg","ajah","console","length","stopMonitor","window","clearInterval","$","css","startMonitor","setInterval","processWaiting","aInitialized","finish","url","val","from","i","splice","processSO","raw","parser","DOMParser","html","parseFromString","newSO","oldSO","innerHTML","document","getElementById","getXmlHttpObject","xmlHttp","XMLHttpRequest","e1","ActiveXObject","e2","parseURL","a","createElement","href","source","protocol","replace","host","hostname","port","query","search","params","ret","seg","split","len","s","file","pathname","match","hash","path","relative","segments","appendId","out","cache_hack","parts","session_override","Math","random","request","shift","push","onreadystatechange","content","readyState","status","responseText","func","open","setRequestHeader","send","XHR","name","inQueue","j","k","Busy","DoWith","setTimeout","DoWithPost","Send","SendFile","SelfTest","paint","LogDiv","done"],"mappings":"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"}